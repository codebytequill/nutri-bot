<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RL Nutri-Bot Trainer</title>
    <style>
        :root { --primary: #2563eb; --success: #22c55e; --danger: #ef4444; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; color: #333; }
        
        /* Layout */
        .container { max-width: 800px; width: 100%; display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media(min-width: 768px) { .container { grid-template-columns: 1fr 1fr; } }

        /* Cards */
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); text-align: center; }
        .monitor { background: #1e293b; color: #0f0; font-family: 'Courier New', monospace; text-align: left; }
        
        /* Elements */
        .food-display { font-size: 80px; margin: 20px 0; animation: bounce 1s infinite alternate; }
        .badge { background: #e2e8f0; padding: 5px 10px; border-radius: 12px; font-size: 0.8em; font-weight: bold; color: #64748b; }
        
        /* Buttons */
        .btn-group { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        button { border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: transform 0.1s; }
        button:active { transform: scale(0.95); }
        .btn-reward { background: var(--success); color: white; }
        .btn-punish { background: var(--danger); color: white; }
        .btn-next { background: var(--primary); color: white; width: 100%; margin-top: 15px; }

        /* Q-Table Visualization */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; color: #fff; font-size: 0.9em; }
        th, td { border: 1px solid #334155; padding: 8px; text-align: center; }
        th { color: #94a3b8; }
        .highlight { background: rgba(34, 197, 94, 0.2); }

        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <div class="container">
        <div class="card">
            <span class="badge">TRAINING MODE</span>
            <h2>Nutri-Bot 9000</h2>
            <div id="food-icon" class="food-display">ü•ó</div>
            <h3 id="food-name">Fresh Salad</h3>
            <hr>
            <p>Agent Action:</p>
            <h1 id="agent-action" style="color: var(--primary)">Thinking...</h1>
            
            <div id="feedback-panel" style="display:none;">
                <p>Was this a healthy choice?</p>
                <div class="btn-group">
                    <button class="btn-reward" onclick="giveFeedback(1)">‚úÖ Good Bot (+1)</button>
                    <button class="btn-punish" onclick="giveFeedback(-1)">‚ùå Bad Bot (-1)</button>
                </div>
            </div>
            
            <button id="next-btn" class="btn-next" onclick="nextRound()" style="display:none;">Next Image ‚Üí</button>
        </div>

        <div class="card monitor">
            <h3>üß† Agent Brain (Q-Table)</h3>
            <p style="font-size: 0.8em; color: #94a3b8;">This table tracks the "value" of every action.</p>
            <table id="q-table">
                <thead>
                    <tr>
                        <th>State (Food)</th>
                        <th>Action: EAT</th>
                        <th>Action: PASS</th>
                    </tr>
                </thead>
                <tbody id="q-body">
                    </tbody>
            </table>
            <br>
            <div id="log" style="height: 150px; overflow-y: auto; border-top: 1px solid #334155; padding-top: 10px; font-size: 0.8em;">
                > System initialized...<br>
            </div>
        </div>
    </div>

<script>
    // --- 1. CONFIGURATION ---
    // The "States" our agent can see
    const foods = [
        { name: "Fresh Salad", icon: "ü•ó", type: "healthy" },
        { name: "Greasy Burger", icon: "üçî", type: "unhealthy" },
        { name: "Apple", icon: "üçé", type: "healthy" },
        { name: "Donut", icon: "üç©", type: "unhealthy" },
        { name: "Water", icon: "üíß", type: "healthy" },
        { name: "Soda", icon: "ü•§", type: "unhealthy" }
    ];

    // The "Brain" (Q-Table): Stores values for [Food][Eat] and [Food][Pass]
    // Initialize all values to 0
    let qTable = {};
    foods.forEach(f => {
        qTable[f.name] = { eat: 0.0, pass: 0.0 };
    });

    // Hyperparameters
    const learningRate = 0.5; // How fast it learns
    const epsilon = 0.2;      // Exploration rate (20% chance to try random stuff)
    
    // Current State
    let currentFood = null;
    let currentAction = null; // 'eat' or 'pass'

    // --- 2. CORE FUNCTIONS ---

    function init() {
        renderTable();
        nextRound();
    }

    // Start a new round
    function nextRound() {
        // Pick random food
        currentFood = foods[Math.floor(Math.random() * foods.length)];
        
        // Update UI
        document.getElementById('food-icon').innerText = currentFood.icon;
        document.getElementById('food-name').innerText = currentFood.name;
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('feedback-panel').style.display = 'block';
        
        // Agent decides
        decideAction();
    }

    // The Agent's Decision Logic
    function decideAction() {
        const memory = qTable[currentFood.name];
        
        // Epsilon-Greedy Strategy:
        // Sometimes explore (random), sometimes exploit (use memory)
        if (Math.random() < epsilon) {
            currentAction = Math.random() < 0.5 ? 'eat' : 'pass';
            log(`üé≤ Exploring: Agent chose randomly to ${currentAction.toUpperCase()}.`);
        } else {
            // Exploit: Choose the higher value
            if (memory.eat > memory.pass) currentAction = 'eat';
            else if (memory.pass > memory.eat) currentAction = 'pass';
            else currentAction = Math.random() < 0.5 ? 'eat' : 'pass'; // Tie-breaker
            
            log(`üß† Exploiting: Agent chose ${currentAction.toUpperCase()} based on memory.`);
        }

        // Display Action
        const actionText = document.getElementById('agent-action');
        actionText.innerText = currentAction === 'eat' ? "üòã I'll EAT it!" : "‚úã I'll PASS.";
        actionText.style.color = currentAction === 'eat' ? '#22c55e' : '#ef4444';
    }

    // The Learning Step (The "Math" part)
    function giveFeedback(reward) {
        // Q-Learning Formula (Simplified):
        // NewValue = OldValue + LearningRate * (Reward - OldValue)
        
        const oldValue = qTable[currentFood.name][currentAction];
        const newValue = oldValue + learningRate * (reward - oldValue);
        
        // Update Memory
        qTable[currentFood.name][currentAction] = parseFloat(newValue.toFixed(2));
        
        // Log & Visualize
        log(`user sent reward: ${reward}. Updated ${currentFood.name} [${currentAction.toUpperCase()}] to ${newValue.toFixed(2)}`);
        renderTable();
        
        // UI Cleanup
        document.getElementById('feedback-panel').style.display = 'none';
        document.getElementById('next-btn').style.display = 'block';
    }

    // --- 3. HELPER FUNCTIONS ---

    function renderTable() {
        const tbody = document.getElementById('q-body');
        tbody.innerHTML = '';
        
        foods.forEach(f => {
            const row = document.createElement('tr');
            const vals = qTable[f.name];
            
            // Highlight the best action for this row
            const eatClass = vals.eat > vals.pass ? 'highlight' : '';
            const passClass = vals.pass > vals.eat ? 'highlight' : '';

            row.innerHTML = `
                <td>${f.icon} ${f.name}</td>
                <td class="${eatClass}">${vals.eat}</td>
                <td class="${passClass}">${vals.pass}</td>
            `;
            tbody.appendChild(row);
        });
    }

    function log(msg) {
        const logBox = document.getElementById('log');
        logBox.innerHTML += `> ${msg}<br>`;
        logBox.scrollTop = logBox.scrollHeight;
    }

    // Start App
    init();

</script>
</body>
</html>
